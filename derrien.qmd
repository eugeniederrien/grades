---
title: "Final Lab"
author: "Eug√©nie Derrien"
format: html
---

```{r}
#| message: false
here::i_am("grades.Rproj")
library(here)
library(readr)
```

```{r}
#| message: false
library(ggplot2)
library(dplyr)
library(tidyr)
library(knitr)
library(lubridate)
```

## Question 1 

```{r}
courses <- read_csv(here("data", "courses.csv"))
```

## Question 2 

```{r}
courses <- courses %>%
  rename(
    `course identifier` = course_id,
    `number of grades` = nb_grades
  ) %>%
  arrange(course)

kable(
  courses,
  caption = "Courses (sorted alphabetically)",
  align = "l"
)
```

## Question 3

```{r}
students <- read_delim(here("data", "students.csv"), 
                        col_types = cols(
                    id = col_integer(),
                    group = col_factor(),
                    birth_date = col_date(),
                    sex = col_factor()
                  ))
spec(students)

paste("The birth_date column of the students data frame is of class", class(students$birth_date)[1])

```

## Question 4 

```{r}
grades <- read_delim(here("data", "grades.csv"),
  delim = ":",
  na = "_", 
   col_types = cols(
                    id = col_integer  #I load id as an integer since I did the same for students
  ))

spec(grades)

# I choose to rename course_id as i did for the courses databases for simplicity and clarity

grades <- grades %>%
  rename(
    `course identifier` = course_id
  )
```

## Question 5

```{r}
ggplot(
  students %>%
    group_by(group) %>%
    summarise(n_students = n()) %>% 
    ungroup(),
  aes(x = group, y = n_students)
) +
  geom_col() +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  ) +
  theme_minimal()

```

## Question 6 

```{r}
ggplot(students %>%
  group_by(group, sex) %>%
  summarise(n_students = n()) %>%
  ungroup()
  , aes(x = group, y = n_students, fill = sex)) +
  geom_col() +
  labs(
    title = "Gender Balance per Group",
    x = "Group",
    y = "Number of Students",
    fill = "Sex"
  ) +
  scale_fill_discrete(labels = c("F" = "Female", "M" = "Male")) +
  theme_minimal()
```

## Question 7

```{r}
students <- students %>%
  mutate(age = round(time_length(today() - birth_date, unit = "year")))

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "slateblue", color = "black") +
  labs(
    title = "Distribution of Students' Age",
    x = "Age (years)",
    y = "Number of Students"
  ) +
  theme_minimal()

```

## Question 8 

```{r}
median_age_per_group <- students %>%
  group_by(group) %>%
  summarise(median_age = as.integer(round(median(age)))) %>%  # We round the median to an integer
  ungroup()

typeof(median_age_per_group$median_age)

kable(median_age_per_group, caption = "Median Age of Students per Group", align = "l")

```










