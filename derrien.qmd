---
title: "Final Lab"
author: "Eug√©nie Derrien"
format: html
---

Link to the github repository : https://github.com/eugeniederrien/grades

```{r}
#| message: false
here::i_am("grades.Rproj")
library(here)
library(readr)
```

```{r}
#| message: false
library(ggplot2)
library(dplyr)
library(tidyr)
library(knitr)
library(lubridate)
```

## Question 1 

```{r}
#| message: false
courses <- read_csv(here("data", "courses.csv"))
```

## Question 2 

```{r}
#| message: false
courses <- courses %>%
  rename(
    identifier = course_id,
    `number of grades` = nb_grades
  ) %>%
  arrange(course)

kable(
  courses,
  caption = "Courses (sorted alphabetically)",
  align = "l"
)
```

## Question 3

```{r}
#| message: false
students <- read_delim(here("data", "students.csv"), 
                        col_types = cols(
                    id = col_integer(),
                    group = col_factor(),
                    birth_date = col_date(),
                    sex = col_factor()
                  ))
spec(students)

paste("The birth_date column of the students data frame is of class", class(students$birth_date)[1])

```

## Question 4 

```{r}
grades <- read_delim(here("data", "grades.csv"),
  delim = ":",
  na = "_", 
   col_types = cols(
                    id = col_integer()  #I load id as an integer since I did the same for students
  ))

spec(grades)

```

## Question 5

```{r}
ggplot(
  students %>%
    group_by(group) %>%
    summarise(n_students = n()) %>% 
    ungroup(),
  aes(x = group, y = n_students)
) +
  geom_col() +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  ) +
  theme_minimal()

```

## Question 6 

```{r}
ggplot(students %>%
  group_by(group, sex) %>%
  summarise(n_students = n()) %>%
  ungroup()
  , aes(x = group, y = n_students, fill = sex)) +
  geom_col() +
  labs(
    title = "Gender Balance per Group",
    x = "Group",
    y = "Number of Students",
    fill = "Sex"
  ) +
  scale_fill_discrete(labels = c("F" = "Female", "M" = "Male")) +
  theme_minimal()
```

## Question 7

```{r}
students <- students %>%
  mutate(age = round(time_length(today() - birth_date, unit = "year")))

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "slateblue", color = "black") +
  labs(
    title = "Distribution of Students' Age",
    x = "Age (years)",
    y = "Number of Students"
  ) +
  theme_minimal()

```

## Question 8 

```{r}
median_age_per_group <- students %>%
  group_by(group) %>%
  summarise(median_age = as.integer(round(median(age)))) %>%  # We round the median to an integer
  ungroup()

typeof(median_age_per_group$median_age)

kable(median_age_per_group, caption = "Median Age of Students per Group", align = "l")

```


## Question 9 

```{r}
kable(students %>%
  group_by(group) %>%
  slice_max(order_by = age, n = 1, with_ties = FALSE) %>%
  ungroup() %>%
  select(id, sex, age, group) %>% 
  arrange(desc(age))
  , caption = "Oldest Student in Each Group", 
  align = "l")
```

## Question 10

```{r}
n_grades <- grades %>%
  filter(!is.na(grade)) %>%
  nrow()

paste("The data set contains", n_grades, "grades.")
```

## Question 11 

```{r}
grades_courses <- grades %>%
  left_join(courses, by = c("course_id" = "identifier"))

grades_courses_students <- grades_courses %>%
  left_join(students %>% select(id, group), by = "id")

avg_grades <- grades_courses_students %>%
  filter(course == "Warfare and Diplomacy", !is.na(grade)) %>%
  group_by(group) %>%
  summarise(avg_grade = mean(grade)) %>%
  ungroup()

ggplot(avg_grades, aes(x = group, y = avg_grade)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Average Grade in 'Warfare and Diplomacy' by Group",
    x = "Group",
    y = "Average Grade"
  ) +
  theme_minimal()
```

## Question 12

```{r}
ggplot(grades_courses_students %>% filter(!is.na(grade)), 
       aes(x = factor(trimester), y = grade, fill = factor(trimester))) +
  geom_boxplot() +
  labs(
    title = "Distribution of Grades by Trimester",
    x = "Trimester",
    y = "Grade",
    fill = "Trimester"
  ) +
  theme_minimal()
```





